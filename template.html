<!DOCTYPE html>
<html>

  <head>
    <title>QGIS Track Profile 2 Web</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <style>
      html,
      body,
      .leaflet-map,
      .elevation-div {
        height: 100%;
        width: 100%;
        padding: 0px;
        margin: 0px;
      }

      .leaflet-map {
        height: 55%;
        max-height: 100vh;
      }

      .elevation-div {
        height: 25%;
        font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
      }

      .custom-theme.elevation-control.elevation .area {
        fill: { area_fill_color };
        stroke: #000;
        stroke-width: { area_stroke_width };
      }

      .custom-theme.height-focus.circle-lower {
        fill: { marker_color };
      }

      .custom-theme.elevation-polyline {
        stroke: { line_color };
        stroke-opacity: { line_opacity };
      }
    </style>

    <!-- D3 -->
    <!-- <script src="https://unpkg.com/d3@6.5.0/dist/d3.js"></script> -->

    <!-- Leaflet (JS/CSS) -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/leaflet-ui@0.5.0/dist/leaflet-ui-src.js"></script>

    <!-- leaflet-elevation -->
    <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation@1.5.6/dist/leaflet-elevation.min.css" />
    <script src="https://unpkg.com/@raruto/leaflet-elevation@1.5.6/dist/leaflet-elevation.js"></script>

  </head>

  <body>

    <div id="map" class="leaflet-map"></div>

    <script>
    // convert the python dictionary into a js variable
    var opts = '{ py_opts }';

    // Instantiate map (leaflet-ui).
    var map = new L.Map('map', opts.map);

    var baseLayers = {};
    baseLayers.OTM = L.tileLayer(opts.otmLayer.url, opts.otmLayer.options).addTo(map)

    // L.Control.Elevation.prototype.__D3 = "https://unpkg.com/d3@6.7.0/dist/d3.js";

    // Instantiate elevation control.
    var controlElevation = L.control.elevation(opts.elevationControl).addTo(map);
    var controlLayer = L.control.layers(baseLayers, null, opts.layersControl).addTo(map);

    map.on('eledata_loaded', function(e) {
      controlLayer.addOverlay(e.layer, e.name);
    });

    // Load track from url (allowed data types: "*.geojson", "*.gpx", "*.tcx")
    controlElevation.load(opts.elevationControl.data);
  </script>

  </body>

</html>
